<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Dox</title>
<link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>Dox</h1>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">1</div><div class="headers">
<h1>Dox</h1>
</div></div>
<ul><li>
generate LaTeX sources from a markdown file
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">2</div>
<code>
<span class="macro">@Def(<span class="name">file: dox.cpp</span>)</span><br/>
<span class="in1"></span><span class="macro">@put(<span class="name">includes</span>)</span>;<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">main prereqs</span>)</span>;<br/>
<span class="in1"></span><span class="type">int</span> <span class="fn">main</span>(<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">argc</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">char</span> *<span class="type">const</span> <span class="var">argv</span>[]<br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">main</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@End(<span class="name">file: dox.cpp</span>)</span><br/>
</code></div>
<ul><li>
simple main program
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">3</div>
<code>
<span class="macro">@def(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> <span class="str">&lt;iostream&gt;</span><br/>
<span class="in1"></span><span class="keyword">#include</span> <span class="str">&lt;string&gt;</span><br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
<ul><li>
needs libraries for string processing
</li></ul>
</div>
</div>
<h2>Theme selection</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">4</div><div class="headers">
<h2>Theme selection</h2>
</div></div>
<ul><li>
<code><span class="var">dox</span></code> can generate output with different themes
</li><li>
specify theme with a command line argument
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">5</div>
<code>
<span class="macro">@def(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">theme</span> {};<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
<ul><li>
no default theme is used
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">6</div>
<code>
<span class="macro">@def(<span class="name">main</span>)</span> {<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">light</span> {<br/>
<span class="in2"></span><span class="str">"--theme=light"</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">dark</span> {<br/>
<span class="in2"></span><span class="str">"--theme=dark"</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">argc</span> == <span class="num">2</span> &amp;&amp; <span class="var">argv</span>[<span class="num">1</span>] == <span class="var">light</span>) {<br/>
<span class="in2"></span><span class="var">theme</span> = <span class="str">"light"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">argc</span> == <span class="num">2</span> &amp;&amp; <span class="var">argv</span>[<span class="num">1</span>] == <span class="var">dark</span>) {<br/>
<span class="in2"></span><span class="var">theme</span> = <span class="str">"dark"</span>;<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
<ul><li>
may select other theme based on command line arguments
</li></ul>
</div>
</div>
<h2>Meta-Data</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">7</div><div class="headers">
<h2>Meta-Data</h2>
</div></div>
<ul><li>
collect information about the document
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">8</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">title</span>;<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">author</span>;<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">date</span> { <span class="str">"\\today"</span> };<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
<ul><li>
<code><span class="var">date</span></code> defaults to the LaTeX command for the current day
</li></ul>
</div>
</div>
<h2>Read the next line</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">9</div><div class="headers">
<h2>Read the next line</h2>
</div></div>
<ul><li>
reading one line from standard input
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">10</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">const</span><br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">end_of_file</span> {<br/>
<span class="in3"></span><span class="str">"\r\n"</span><br/>
<span class="in2"></span>};<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
<ul><li>
a special string value marks the end of file
</li><li>
as the newline is stripped by the reading routine the provided string  should never occur during normal reading
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">11</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">nextline</span>(<span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">line</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">line</span> != <span class="var">end_of_file</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (! <span class="type">std</span>::<span class="fn">getline</span>(<span class="type">std</span>::<span class="var">cin</span>, <span class="var">line</span>)) {<br/>
<span class="in4"></span><span class="var">line</span> = <span class="var">end_of_file</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
<ul><li>
reads the next line into the argument
</li><li>
if the end is already reached, nothing will be read
</li></ul>
</div>
</div>
<h2>Reading Meta-Data</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">12</div><div class="headers">
<h2>Reading Meta-Data</h2>
</div></div>
<ul><li>
the start of the read document may contain meta-data
</li><li>
every line until the first empty line is considered meta-data
</li><li>
but nonetheless the meta-data is formatted as regular markdown code
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">13</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">line</span>;<br/>
<span class="in1"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">read metadata</span>)</span>;<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
<ul><li>
read the first line
</li><li>
and process meta-data
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">14</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="type">bool</span> <span class="fn">has_prefix</span>(<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">line</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">prefix</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">auto</span> &amp;<span class="var">l</span> { <span class="var">line</span> };<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">auto</span> &amp;<span class="var">p</span> { <span class="var">prefix</span> };<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">l</span>.<span class="fn">size</span>() &gt;= <span class="var">p</span>.<span class="fn">size</span>() &amp;&amp;<br/>
<span class="in3"></span><span class="var">l</span>.<span class="fn">substr</span>(<span class="num">0</span>, <span class="var">p</span>.<span class="fn">size</span>()) == <span class="var">p</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
<ul><li>
check if a string starts with the specified prefix
</li><li>
this is used a couple of times in the program
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">15</div>
<code>
<span class="macro">@def(<span class="name">read metadata</span>)</span> {<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">prefix</span> {<br/>
<span class="in2"></span><span class="str">"# "</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="fn">has_prefix</span>(<span class="var">line</span>, <span class="var">prefix</span>)) {<br/>
<span class="in2"></span><span class="var">title</span> = <span class="var">line</span>.<span class="fn">substr</span>(<br/>
<span class="in3"></span><span class="var">prefix</span>.<span class="fn">size</span>()<br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in1"></span>} <span class="keyword">else</span> {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"no title\n"</span>;<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">read metadata</span>)</span><br/>
</code></div>
<ul><li>
the first meta-data must be the title that is provided with a lever 1  heading
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">16</div>
<code>
<span class="macro">@add(<span class="name">read metadata</span>)</span> {<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">prefix</span> {<br/>
<span class="in2"></span><span class="str">"* author: "</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="fn">has_prefix</span>(<span class="var">line</span>, <span class="var">prefix</span>)) {<br/>
<span class="in2"></span><span class="var">author</span> = <span class="var">line</span>.<span class="fn">substr</span>(<br/>
<span class="in3"></span><span class="var">prefix</span>.<span class="fn">size</span>()<br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in1"></span>} <span class="keyword">else</span> {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"no author\n"</span>;<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">read metadata</span>)</span><br/>
</code></div>
<ul><li>
the next line specifies the author
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">17</div>
<code>
<span class="macro">@add(<span class="name">read metadata</span>)</span> {<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">prefix</span> {<br/>
<span class="in2"></span><span class="str">"* date: "</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="fn">has_prefix</span>(<span class="var">line</span>, <span class="var">prefix</span>)) {<br/>
<span class="in2"></span><span class="var">date</span> = <span class="var">line</span>.<span class="fn">substr</span>(<br/>
<span class="in3"></span><span class="var">prefix</span>.<span class="fn">size</span>()<br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">read metadata</span>)</span><br/>
</code></div>
<ul><li>
the next line may specify the generation date
</li><li>
if no date is provided, the program uses the current date
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">18</div>
<code>
<span class="macro">@add(<span class="name">read metadata</span>)</span><br/>
<span class="in1"></span><span class="keyword">while</span> (<br/>
<span class="in2"></span><span class="var">line</span> != <span class="var">end_of_file</span> &amp;&amp; <span class="var">line</span>.<span class="fn">size</span>()<br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt;<br/>
<span class="in3"></span><span class="str">"ignoring meta line: "</span> &lt;&lt;<br/>
<span class="in3"></span><span class="var">line</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">read metadata</span>)</span><br/>
</code></div>
<ul><li>
all other lines until the first empty line are ignored
</li></ul>
</div>
</div>
<h2>Writing the preamble</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">19</div><div class="headers">
<h2>Writing the preamble</h2>
</div></div>
<ul><li>
after <code><span class="var">dox</span></code> read the meta-data it writes the LaTeX preamble
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">20</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt;<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">preamble</span>)</span>;<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
<ul><li>
write the preamble
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">21</div>
<code>
<span class="macro">@inc(<span class="name"><a href="preamble.html">preamble.md</a></span>)</span><br/>
</code></div>
<ul><li>
preamble is defined in another document
</li></ul>
</div>
</div>
<h2>Handle Two-Column Style</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">22</div><div class="headers">
<h2>Handle Two-Column Style</h2>
</div></div>
<ul><li>
output can switch between one-column and two-column style
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">23</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="type">bool</span> <span class="var">in_two_columns</span> { <span class="num">false</span> };<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
<ul><li>
is the output currently in two-column style?
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">24</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">enter_two_columns</span>() {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">in_two_columns</span>) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt;<br/>
<span class="in4"></span><span class="str">"\\begin{multicols}{2}\n"</span>;<br/>
<span class="in3"></span><span class="var">in_two_columns</span> = <span class="num">true</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
<ul><li>
switch into two-column style
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">25</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">exit_two_columns</span>() {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">in_two_columns</span>) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt;<br/>
<span class="in4"></span><span class="str">"\\end{multicols}\n"</span>;<br/>
<span class="in3"></span><span class="var">in_two_columns</span> = <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
<ul><li>
switch back into one-column style
</li></ul>
</div>
</div>
<h2>Process main body</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">26</div><div class="headers">
<h2>Process main body</h2>
</div></div>
<ul><li>
process the main body of text
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">27</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="var">line</span> != <span class="var">end_of_file</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process line</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="fn">exit_two_columns</span>();<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\end{document}\n"</span>;<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
<ul><li>
read and process all lines
</li><li>
and close the document
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">28</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">format_line</span>(<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">line</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">format line</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
<ul><li>
do special formatting of all the special sequences in one line of  normal text
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">29</div>
<code>
<span class="macro">@def(<span class="name">process line</span>)</span><br/>
<span class="in1"></span><span class="keyword">do</span> {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process special</span>)</span>;<br/>
<span class="in2"></span><span class="fn">enter_two_columns</span>();<br/>
<span class="in2"></span><span class="fn">format_line</span>(<span class="var">line</span>);<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in1"></span>} <span class="keyword">while</span> (<span class="num">false</span>);<br/>
<span class="macro">@end(<span class="name">process line</span>)</span><br/>
</code></div>
<ul><li>
first process some special lines
</li><li>
if no special line is found do the normal processing
</li><li>
in two-column style
</li><li>
and read the next line
</li></ul>
</div>
</div>
<h2>Process section headers</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">30</div><div class="headers">
<h2>Process section headers</h2>
</div></div>
<ul><li>
process the section and subsection headers
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">31</div>
<code>
<span class="macro">@def(<span class="name">process special</span>)</span> {<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">prefix</span> {<br/>
<span class="in2"></span><span class="str">"## "</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="fn">has_prefix</span>(<span class="var">line</span>, <span class="var">prefix</span>)) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">write section</span>)</span>;<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">process special</span>)</span><br/>
</code></div>
<ul><li>
process section header
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">32</div>
<code>
<span class="macro">@def(<span class="name">write section</span>)</span><br/>
<span class="in1"></span><span class="fn">exit_two_columns</span>();<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\section{"</span>;<br/>
<span class="in1"></span><span class="fn">format_line</span>(<span class="var">line</span>.<span class="fn">substr</span>(<br/>
<span class="in2"></span><span class="var">prefix</span>.<span class="fn">size</span>()<br/>
<span class="in1"></span>));<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"}\n"</span>;<br/>
<span class="macro">@end(<span class="name">write section</span>)</span><br/>
</code></div>
<ul><li>
section headers are in one-column style
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">33</div>
<code>
<span class="macro">@add(<span class="name">process special</span>)</span> {<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">prefix</span> {<br/>
<span class="in2"></span><span class="str">"### "</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="fn">has_prefix</span>(<span class="var">line</span>, <span class="var">prefix</span>)) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\subsection{"</span>;<br/>
<span class="in2"></span><span class="fn">format_line</span>(<span class="var">line</span>.<span class="fn">substr</span>(<br/>
<span class="in3"></span><span class="var">prefix</span>.<span class="fn">size</span>()<br/>
<span class="in2"></span>));<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"}\n"</span>;<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">process special</span>)</span><br/>
</code></div>
<ul><li>
subsections stay in the current columns style
</li></ul>
</div>
</div>
<h2>Handle emphasis</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">34</div><div class="headers">
<h2>Handle emphasis</h2>
</div></div>
<ul><li>
text in a line can be emphasised
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">35</div>
<code>
<span class="macro">@def(<span class="name">format line</span>)</span><br/>
<span class="in1"></span><span class="keyword">for</span> (<span class="type">unsigned</span> <span class="var">i</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="var">i</span> &lt; <span class="var">line</span>.<span class="fn">size</span>(); ++<span class="var">i</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">handle format</span>)</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">line</span>[<span class="var">i</span>];<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">format line</span>)</span><br/>
</code></div>
<ul><li>
iterate over each char
</li><li>
and process special format sequences
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">36</div>
<code>
<span class="macro">@def(<span class="name">handle format</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">line</span>[<span class="var">i</span>] == <span class="str">'*'</span> || <span class="var">line</span>[<span class="var">i</span>] == <span class="str">'_'</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">emphasise</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">handle format</span>)</span><br/>
</code></div>
<ul><li>
emphasise following words
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">37</div>
<code>
<span class="macro">@def(<span class="name">emphasise</span>)</span><br/>
<span class="in1"></span><span class="type">unsigned</span> <span class="var">j</span> { <span class="var">i</span> + <span class="num">1</span> };<br/>
<span class="in1"></span><span class="type">char</span> <span class="var">mark</span> { <span class="var">line</span>[<span class="var">i</span>] };<br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="var">j</span> &lt; <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp;<br/>
<span class="in2"></span><span class="var">line</span>[<span class="var">j</span>] &gt;= <span class="str">' '</span> &amp;&amp; (<br/>
<span class="in3"></span><span class="fn">isalnum</span>(<span class="var">line</span>[<span class="var">j</span>]) ||<br/>
<span class="in3"></span><span class="var">line</span>[<span class="var">j</span>] == <span class="str">'*'</span> ||<br/>
<span class="in3"></span><span class="var">line</span>[<span class="var">j</span>] == <span class="str">'_'</span> ||<br/>
<span class="in3"></span><span class="var">line</span>[<span class="var">j</span>] == <span class="str">'-'</span><br/>
<span class="in2"></span>)<br/>
<span class="in1"></span>) { ++<span class="var">j</span>; }<br/>
<span class="macro">@end(<span class="name">emphasise</span>)</span><br/>
</code></div>
<ul><li>
find end of chars to highlight
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">38</div>
<code>
<span class="macro">@add(<span class="name">emphasise</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">i</span> + <span class="num">1</span> &lt; <span class="var">j</span> &amp;&amp;<br/>
<span class="in2"></span><span class="var">line</span>[<span class="var">j</span> - <span class="num">1</span>] == <span class="var">mark</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">do emphasis</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">emphasise</span>)</span><br/>
</code></div>
<ul><li>
if start and end differ and have the same mark, it is a legal  highlight sequence
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">39</div>
<code>
<span class="macro">@def(<span class="name">do emphasis</span>)</span><br/>
<span class="in1"></span><span class="type">bool</span> <span class="var">bold</span> {<br/>
<span class="in2"></span><span class="var">i</span> + <span class="num">3</span> &lt; <span class="var">j</span> &amp;&amp;<br/>
<span class="in2"></span><span class="var">line</span>[<span class="var">i</span> + <span class="num">1</span>] == <span class="var">mark</span> &amp;&amp;<br/>
<span class="in2"></span><span class="var">line</span>[<span class="var">j</span> - <span class="num">2</span>] == <span class="var">mark</span><br/>
<span class="in1"></span>};<br/>
<span class="macro">@end(<span class="name">do emphasis</span>)</span><br/>
</code></div>
<ul><li>
if two marks are at the beginning and ending use bold highlight
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">40</div>
<code>
<span class="macro">@add(<span class="name">do emphasis</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">bold</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\textbf{"</span>;<br/>
<span class="in1"></span>} <span class="keyword">else</span> {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\emph{"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">do emphasis</span>)</span><br/>
</code></div>
<ul><li>
write bold or italics tag
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">41</div>
<code>
<span class="macro">@add(<span class="name">do emphasis</span>)</span><br/>
<span class="in1"></span><span class="type">unsigned</span> <span class="var">begin</span> {<br/>
<span class="in2"></span><span class="var">bold</span> ? <span class="var">i</span> + <span class="num">2</span> : <span class="var">i</span> + <span class="num">1</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="type">unsigned</span> <span class="var">end</span> { <span class="var">bold</span> ? <span class="var">j</span> - <span class="num">2</span> : <span class="var">j</span> - <span class="num">1</span> };<br/>
<span class="in1"></span><span class="keyword">for</span> (<span class="type">auto</span> <span class="var">t</span> { <span class="var">begin</span> }; <span class="var">t</span> &lt; <span class="var">end</span>; ++<span class="var">t</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">emphasis loop</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"}"</span>;<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">add padding</span>)</span>;<br/>
<span class="in1"></span><span class="var">i</span> = <span class="var">j</span> - <span class="num">1</span>;<br/>
<span class="in1"></span><span class="keyword">continue</span>;<br/>
<span class="macro">@end(<span class="name">do emphasis</span>)</span><br/>
</code></div>
<ul><li>
write the emphasised characters
</li><li>
close tag
</li><li>
and skip over the processed characters
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">42</div>
<code>
<span class="macro">@def(<span class="name">emphasis loop</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span>[<span class="var">t</span>] == <span class="var">mark</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">' '</span>;<br/>
<span class="in1"></span>} <span class="keyword">else</span> {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">line</span>[<span class="var">t</span>];<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">emphasis loop</span>)</span><br/>
</code></div>
<ul><li>
replace the marking char with spaces
</li><li>
and copy all other chars
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">43</div>
<code>
<span class="macro">@def(<span class="name">add padding</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span>[<span class="var">j</span>] == <span class="str">' '</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">'\\'</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">add padding</span>)</span><br/>
</code></div>
<ul><li>
if a space follows the emphasise sequence
</li><li>
it must be padded
</li><li>
otherwise it is swallowed by TeX
</li></ul>
</div>
</div>
<h2>Handle lists</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">44</div><div class="headers">
<h2>Handle lists</h2>
</div></div>
<ul><li>
format lists
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">45</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="type">enum</span> <span class="keyword">class</span> <span class="type">List_Type</span> {<br/>
<span class="in2"></span><span class="var">no_list</span>, <span class="var">enum_list</span>, <span class="var">item_list</span><br/>
<span class="in1"></span>} <span class="var">list_type</span> { <span class="type">List_Type</span>::<span class="var">no_list</span> };<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
<ul><li>
is the output currently in a list item
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">46</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">open_list</span>(<span class="type">bool</span> <span class="var">enumerate</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">list_type</span> == <span class="type">List_Type</span>::<span class="var">no_list</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">enumerate</span>) {<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\begin{enumerate}\n"</span>;<br/>
<span class="in4"></span><span class="var">list_type</span> = <span class="type">List_Type</span>::<span class="var">enum_list</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\begin{itemize}\n"</span>;<br/>
<span class="in4"></span><span class="var">list_type</span> = <span class="type">List_Type</span>::<span class="var">item_list</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\item "</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">47</div>
<code>
<span class="macro">@add(<span class="name">main prereqs</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">close_list</span>() {<br/>
<span class="in2"></span><span class="keyword">switch</span> (<span class="var">list_type</span>) {<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="type">List_Type</span>::<span class="var">no_list</span>:<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="type">List_Type</span>::<span class="var">enum_list</span>:<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\end{enumerate}\n"</span>;<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="type">List_Type</span>::<span class="var">item_list</span>:<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\end{itemize}\n"</span>;<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">list_type</span> = <span class="type">List_Type</span>::<span class="var">no_list</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main prereqs</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">48</div>
<code>
<span class="macro">@add(<span class="name">process special</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span> == <span class="str">""</span>) {<br/>
<span class="in2"></span><span class="fn">close_list</span>();<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process special</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">49</div>
<code>
<span class="macro">@add(<span class="name">process special</span>)</span> {<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">prefix</span> {<br/>
<span class="in2"></span><span class="str">"* "</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="fn">has_prefix</span>(<span class="var">line</span>, <span class="var">prefix</span>)) {<br/>
<span class="in2"></span><span class="fn">open_list</span>(<span class="num">false</span>);<br/>
<span class="in2"></span><span class="fn">format_line</span>(<span class="var">line</span>.<span class="fn">substr</span>(<span class="var">prefix</span>.<span class="fn">size</span>()));<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">process special</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">50</div>
<code>
<span class="macro">@add(<span class="name">process special</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span>.<span class="fn">size</span>() &amp;&amp; <span class="fn">isdigit</span>(<span class="var">line</span>[<span class="num">0</span>])) {<br/>
<span class="in2"></span><span class="type">unsigned</span> <span class="var">i</span> { <span class="num">1</span> };<br/>
<span class="in2"></span><span class="keyword">while</span> (<span class="var">i</span> &lt; <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp; <span class="fn">isdigit</span>(<span class="var">line</span>[<span class="var">i</span>])) { ++<span class="var">i</span>; }<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">i</span> + <span class="num">1</span> &lt; <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp; <span class="var">line</span>[<span class="var">i</span>] == <span class="str">'.'</span> &amp;&amp; <span class="var">line</span>[<span class="var">i</span> + <span class="num">1</span>] == <span class="str">' '</span>) {<br/>
<span class="in3"></span><span class="fn">open_list</span>(<span class="num">true</span>);<br/>
<span class="in3"></span><span class="fn">format_line</span>(<span class="var">line</span>.<span class="fn">substr</span>(<span class="var">i</span> + <span class="num">1</span>));<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="in3"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in3"></span><span class="keyword">break</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process special</span>)</span><br/>
</code></div>
<ul><li>
subsections stay in the current columns style
</li></ul>
</div>
</div>
<h2>Handle math</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">51</div><div class="headers">
<h2>Handle math</h2>
</div></div>
<ul><li>
verbose copy math blocks
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">52</div>
<code>
<span class="macro">@add(<span class="name">handle format</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span>[<span class="var">i</span>] == <span class="str">'$'</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">math</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">handle format</span>)</span><br/>
</code></div>
<ul><li>
start of math mode
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">53</div>
<code>
<span class="macro">@def(<span class="name">math</span>)</span><br/>
<span class="in1"></span><span class="type">unsigned</span> <span class="var">j</span> { <span class="var">i</span> + <span class="num">1</span> };<br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="var">j</span> &lt; <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp;<br/>
<span class="in2"></span><span class="var">line</span>[<span class="var">j</span>] != <span class="str">'$'</span><br/>
<span class="in1"></span>) { ++<span class="var">j</span>; }<br/>
<span class="macro">@end(<span class="name">math</span>)</span><br/>
</code></div>
<ul><li>
find end of math mode
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">54</div>
<code>
<span class="macro">@add(<span class="name">math</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">j</span> &lt; <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp; <span class="var">line</span>[<span class="var">j</span>] == <span class="str">'$'</span>) {<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">auto</span> <span class="var">t</span> { <span class="var">i</span> }; <span class="var">t</span> &lt;= <span class="var">j</span>; ++<span class="var">t</span>) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">line</span>[<span class="var">t</span>];<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">i</span> = <span class="var">j</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">math</span>)</span><br/>
</code></div>
<ul><li>
directly copy math
</li></ul>
</div>
</div>
<h2>Handle Source Code</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">55</div><div class="headers">
<h2>Handle Source Code</h2>
</div></div>
<ul><li>
highlight source code
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">56</div>
<code>
<span class="macro">@add(<span class="name">process special</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span> == <span class="str">"```lisp"</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\begin{lisp}\n"</span>;<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process lisp lines</span>)</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\end{lisp}\n"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process special</span>)</span><br/>
</code></div>
<ul><li>
parse LISP block
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">57</div>
<code>
<span class="macro">@def(<span class="name">process lisp lines</span>)</span><br/>
<span class="in1"></span><span class="type">int</span> <span class="var">nr</span> { <span class="num">1</span> };<br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="var">line</span> != <span class="var">end_of_file</span> &amp;&amp;<br/>
<span class="in2"></span><span class="var">line</span> != <span class="str">"```"</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process lisp line</span>)</span>;<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="in1"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="macro">@end(<span class="name">process lisp lines</span>)</span><br/>
</code></div>
<ul><li>
process each line
</li><li>
close last line with a newline
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">58</div>
<code>
<span class="macro">@def(<span class="name">process lisp line</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">nr</span> &gt; <span class="num">1</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\\\*\n"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process lisp line</span>)</span><br/>
</code></div>
<ul><li>
terminate previous line correctly
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">59</div>
<code>
<span class="macro">@add(<span class="name">process lisp line</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"$\\hlLine{"</span> &lt;&lt;<br/>
<span class="in2"></span><span class="var">nr</span>++ &lt;&lt; <span class="str">"}"</span>;<br/>
<span class="macro">@end(<span class="name">process lisp line</span>)</span><br/>
</code></div>
<ul><li>
enter math mode and write line number
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">60</div>
<code>
<span class="macro">@add(<span class="name">process lisp line</span>)</span><br/>
<span class="in1"></span><span class="type">unsigned</span> <span class="var">i</span> { <span class="num">0</span> };<br/>
<span class="in1"></span><span class="keyword">for</span> (;<br/>
<span class="in2"></span><span class="var">i</span> &lt; <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp;<br/>
<span class="in3"></span><span class="var">line</span>[<span class="var">i</span>] == <span class="str">'\t'</span>;<br/>
<span class="in2"></span>++<span class="var">i</span><br/>
<span class="in1"></span>) {}<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">i</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\hlIndent{"</span> &lt;&lt;<br/>
<span class="in3"></span><span class="var">i</span> &lt;&lt; <span class="str">"}"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process lisp line</span>)</span><br/>
</code></div>
<ul><li>
skip over tabs
</li><li>
and add matching indent
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">61</div>
<code>
<span class="macro">@add(<span class="name">process lisp line</span>)</span><br/>
<span class="in1"></span><span class="keyword">for</span> (; <span class="var">i</span> &lt; <span class="var">line</span>.<span class="fn">size</span>(); ++<span class="var">i</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">line</span>[<span class="var">i</span>] == <span class="str">' '</span>) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">line</span>[<span class="var">i</span>];<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process lisp line</span>)</span><br/>
</code></div>
<ul><li>
copy code
</li><li>
but escape spaces
</li><li>
otherwise they are ignored in math mode
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">62</div>
<code>
<span class="macro">@add(<span class="name">process lisp line</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"$"</span>;<br/>
<span class="macro">@end(<span class="name">process lisp line</span>)</span><br/>
</code></div>
<ul><li>
leave math mode
</li></ul>
</div>
</div>
<h2>Handle inline code</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">63</div><div class="headers">
<h2>Handle inline code</h2>
</div></div>
<ul><li>
display an inline code fragment
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">64</div>
<code>
<span class="macro">@add(<span class="name">handle format</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span>[<span class="var">i</span>] == <span class="str">'`'</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">inline code</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">handle format</span>)</span><br/>
</code></div>
<ul><li>
parse inline code fragment
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">65</div>
<code>
<span class="macro">@def(<span class="name">inline code</span>)</span><br/>
<span class="in1"></span><span class="type">unsigned</span> <span class="var">j</span> { <span class="var">i</span> + <span class="num">1</span> };<br/>
<span class="in1"></span><span class="keyword">for</span> (;<br/>
<span class="in2"></span><span class="var">j</span> &lt; <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp; <span class="var">line</span>[<span class="var">j</span>] != <span class="str">'`'</span>;<br/>
<span class="in2"></span>++<span class="var">j</span><br/>
<span class="in1"></span>) {}<br/>
<span class="macro">@end(<span class="name">inline code</span>)</span><br/>
</code></div>
<ul><li>
find end of fragment
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">66</div>
<code>
<span class="macro">@add(<span class="name">inline code</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">j</span> &lt; <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp;<br/>
<span class="in2"></span><span class="var">line</span>[<span class="var">j</span>] == <span class="str">'`'</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">do inline code</span>)</span>;<br/>
<span class="in2"></span><span class="var">i</span> = <span class="var">j</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">inline code</span>)</span><br/>
</code></div>
<ul><li>
process valid fragment
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">67</div>
<code>
<span class="macro">@def(<span class="name">do inline code</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\hlInline{"</span>;<br/>
<span class="in1"></span><span class="keyword">for</span> (<span class="type">auto</span> <span class="var">t</span> { <span class="var">i</span> + <span class="num">1</span> }; <span class="var">t</span> &lt; <span class="var">j</span>; ++<span class="var">t</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">line</span>[<span class="var">t</span>] == <span class="str">' '</span>) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">line</span>[<span class="var">t</span>];<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"}"</span>;<br/>
<span class="macro">@end(<span class="name">do inline code</span>)</span><br/>
</code></div>
<ul><li>
copy code fragment
</li><li>
but escape spaces
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">68</div>
<code>
<span class="macro">@add(<span class="name">do inline code</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">j</span> + <span class="num">1</span> &lt; <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp;<br/>
<span class="in2"></span><span class="var">line</span>[<span class="var">j</span> + <span class="num">1</span>] == <span class="str">' '</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">do inline code</span>)</span><br/>
</code></div>
<ul><li>
pad trailing space
</li></ul>
</div>
</div>
<h2>Include Graphics</h2>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">69</div><div class="headers">
<h2>Include Graphics</h2>
</div></div>
<ul><li>
include PDF graphics in the correct theme
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">70</div>
<code>
<span class="macro">@add(<span class="name">process special</span>)</span> {<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">prefix</span> {<br/>
<span class="in2"></span><span class="str">"!("</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="fn">has_prefix</span>(<span class="var">line</span>, <span class="var">prefix</span>)) {<br/>
<span class="in2"></span><span class="fn">exit_two_columns</span>();<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">include graphics</span>)</span>;<br/>
<span class="in2"></span><span class="fn">nextline</span>(<span class="var">line</span>);<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">process special</span>)</span><br/>
</code></div>
<ul><li>
parse image
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">71</div>
<code>
<span class="macro">@def(<span class="name">include graphics</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\begin{center}\n"</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt;<br/>
<span class="in2"></span><span class="str">"\\includegraphics[scale=.5]{"</span>;<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">copy themed graphics name</span>)</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">".pdf}\n"</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\\end{center}\n"</span>;<br/>
<span class="macro">@end(<span class="name">include graphics</span>)</span><br/>
</code></div>
<ul><li>
include LaTeX statements to load graphic
</li><li>
only PDF graphics are supported
</li></ul>
</div>
<div class="page"><div class="slide"><div class="slide-nr">72</div>
<code>
<span class="macro">@def(<span class="name">copy themed graphics name</span>)</span><br/>
<span class="in1"></span><span class="type">unsigned</span> <span class="var">i</span> { <span class="var">prefix</span>.<span class="fn">size</span>() };<br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="var">i</span> &lt; <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp;<br/>
<span class="in2"></span><span class="var">line</span>[<span class="var">i</span>] != <span class="str">'}'</span> &amp;&amp; <span class="var">line</span>[<span class="var">i</span>] != <span class="str">'.'</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">line</span>[<span class="var">i</span>];<br/>
<span class="in2"></span>++<span class="var">i</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">theme</span>.<span class="fn">size</span>()) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"-"</span> &lt;&lt; <span class="var">theme</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">copy themed graphics name</span>)</span><br/>
</code></div>
<ul><li>
copy name until the first extension
</li><li>
add theme name if present
</li></ul>
</div>
</body>
</html>
